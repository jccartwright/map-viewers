dojo.provide('multibeam.SurveySelectDialog');dojo.require('dijit.Dialog');dojo.require("dijit.form.NumberSpinner");dojo.require("dijit.form.CheckBox");dojo.declare( 'multibeam.SurveySelectDialog',dijit.Dialog, {	templateString: null,	templatePath: dojo.moduleUrl('multibeam.templates','SurveySelectDialog.html'),	widgetsInTemplate: true,	defaultShip: null,	defaultYear: null,	shipsStore: null,	surveysStore: null,		reset: function() {		this.omitDate.attr('value','true');		this.toggleOmitDate();		this.startYearSpinner.attr('value', new Date().getFullYear());		this.shipSelect.attr('value', 'ALL');				this.surveyNameSelect.query.name = "*";		this.surveyNameSelect.attr('value',null);	},	postCreate: function() {		this.connect(this.cancelButton, "onClick", "hide");		this.connect(this.resetButton, "onClick", "reset");		this.connect(this.omitDate, "onClick", "toggleOmitDate");		this.connect(this.startYearSpinner, "onChange", "filterSurveys");		this.connect(this.shipSelect, "onChange", "filterSurveys");				this.shipSelect.store = this.shipsStore;		this.surveyNameSelect.store = this.surveysStore;		this.surveyNameSelect.query.name = "*";		this.surveyNameSelect.attr('value',null);				//initialize dialog box values		var year = new Date().getFullYear();		if (this.defaultYear) {			year = this.defaultYear;		} else {			this.omitDate.attr('value','true');			this.toggleOmitDate();		}			this.startYearSpinner.attr('value', year);				if (this.defaultShip) {			this.shipSelect.attr('value', this.defaultShip);		} else {			this.shipSelect.attr('value', 'ALL');		}						this.inherited(arguments);	},	/**	 * filters the data available to surveyNameSelect	 */		filterSurveys: function() {		var surveyFilter = {};				//TODO replace use of ALL keyword w/ null?		if (this.shipSelect.attr('value') == 'ALL') {			surveyFilter.ship = '*';		} else {			surveyFilter.ship = this.shipSelect.attr('value');		}		//surveyFilter.ship = this.shipSelect.attr('value') || "*";				surveyFilter.year = "*";		if (this.startYearSpinner.attr('disabled') == false) {			surveyFilter.year = this.startYearSpinner.attr('value').toString();		}				this.surveyNameSelect.query = surveyFilter;				},	toggleOmitDate: function() {		if (this.omitDate.attr('value') == "true") {			this.startYearSpinner.attr('disabled',true);					} else {			this.startYearSpinner.attr('disabled',false);		}		this.filterSurveys();	},	/**	 * function automatically called by submit button. publishes event containing	 * values from dialog 	 */		execute: function(values) {		//console.log('inside execute: ',values);		//BUG: omitDate, startYear values not in values object		values.startYear = this.startYearSpinner.attr('value');		values.omitDate = this.omitDate.attr('value');		//cleanup values passed back to caller		if (values.id != '') {			//Survey Id takes precedence			values.ship = null;			values.startYear = null;			values.omitDate = null;		} else {			values.id = null;			if (values.ship == 'ALL') { values.ship = null; }			if (values.omitDate) { 				values.startYear = null; 				values.omitDate = null;			}		}		dojo.publish("/multibeam/SurveySelectDialog",[values]);	}});