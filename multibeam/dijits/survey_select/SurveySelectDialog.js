dojo.provide('survey_select.SurveySelectDialog');dojo.require('dijit.Dialog');dojo.require("dijit.form.NumberSpinner");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.FilteringSelect");dojo.declare( 'survey_select.SurveySelectDialog',dijit.Dialog, {	templateString: null,	templatePath: dojo.moduleUrl('survey_select.templates','SurveySelectDialog.html'),	widgetsInTemplate: true,	defaultShip: null,	defaultStartYear: null,	//defaultEndYear: null,	//defaultStartYearAdded: null,	//defaultEndYearAdded: null,	shipsStore: null,	surveysStore: null,		reset: function() {		this.omitDate.attr('value','true');		//this.toggleOmitDate();		this.startYearSpinner.attr('value', '');		this.startYearSpinner.attr('disabled',true);		this.omitDate.attr('disabled',false);				//this.endYearSpinner.attr('value', new Date().getFullYear());		//this.endYearSpinner.attr('value', '');				this.shipSelect.attr('value', '');						this.surveyNameSelect.query.name = "*";		this.surveyNameSelect.attr('value',null);				this.shipSelect.attr('disabled',false);				this.zoomToSelection.attr('value','true');				this.filterSurveys();	},	postCreate: function() {/*		this.surveysStore.fetch({			onComplete: function(items, request){				console.log("Dialog: Number of items located: " + items.length);			}		});*/		this.connect(this.cancelButton, "onClick", "hide");		this.connect(this.resetButton, "onClick", "reset");		this.connect(this.omitDate, "onClick", "toggleOmitDate");		this.connect(this.startYearSpinner, "onChange", "filterSurveys");		//this.startYearSpinner.attr('intermediateChanges',true);		this.connect(this.shipSelect, "onChange", "filterSurveys");				this.connect(this.surveyNameSelect,'onChange',function(value){			if (!value) {				return;			}			console.log("survey "+value+" selected");			//Survey Name takes precedence - disable other controls			this.startYearSpinner.attr('disabled',true);			this.omitDate.attr('disabled',true);			this.shipSelect.attr('disabled',true);		});				this.shipSelect.store = this.shipsStore;		this.surveyNameSelect.store = this.surveysStore;		this.surveyNameSelect.query.name = "*";		this.surveyNameSelect.attr('value',null);				//initialize dialog box values		//var endYear = new Date().getFullYear();		//var endYear = null;		var startYear = null;		if (this.defaultStartYear) {			startYear = this.defaultStartYear;		}		//if (this.defaultEndYear) {		//	endYear = this.defaultEndYear;		//}  	//	if (!this.defaultStartYear && !this.defaultEndYear) {		if (!this.defaultStartYear) {			this.omitDate.attr('checked',true);			//this.omitDate.attr('value',true);			this.toggleOmitDate();		}		else {			this.omitDate.attr('checked',false);			//this.omitDate.attr('value',false);			this.toggleOmitDate();		}		this.startYearSpinner.attr('value', startYear);		//this.endYearSpinner.attr('value',endYear);						if (this.defaultShip) {			this.shipSelect.attr('value', this.defaultShip);		} else {			this.shipSelect.attr('value', 'ALL');		}				this.inherited(arguments);	},	/**	 * filters the data available to surveyNameSelect	 */		filterSurveys: function() {		//console.log('inside filterSurveys...');		var surveyFilter = {};				if (this.shipSelect.attr('value') == 'ALL' || this.shipSelect.attr('value') == '' ) {			surveyFilter.ship = '*';		} else {			surveyFilter.ship = this.shipSelect.attr('value');		}							surveyFilter.year = "*";		var dateConstraint;		if (this.startYearSpinner.attr('disabled') == false) {			surveyFilter.year = this.startYearSpinner.attr('value').toString();		}		this.surveyNameSelect.query = surveyFilter;				},	toggleOmitDate: function() {		if (this.omitDate.attr('checked')) {			this.startYearSpinner.attr('disabled',true);			//this.endYearSpinner.attr('disabled',true);		} else {			this.startYearSpinner.attr('disabled',false);			//this.endYearSpinner.attr('disabled',false);		}		this.filterSurveys();	},	/**	 * function automatically called by submit button. publishes event containing	 * values from dialog 	 */		execute: function(values) {		console.log('inside execute: ',values);				//BUG: omitDate, startYear values not in values object		if (! this.omitDate.attr('value')) {			values.startYear = this.startYearSpinner.attr('value');				}				var searchCriteria = {'zoomToSelection': this.zoomToSelection.attr('value')};		if (this.omitDate.attr('value') && values.survey == '' && (values.ship == 'ALL' || values.ship == '')) {			//default values - no criteria specified			dojo.publish("/survey_select/SurveySelectDialog",[]);			return;					}				if (values.survey) {			searchCriteria.survey = values.survey;			//survey name takes precendence over any other criteria			dojo.publish("/survey_select/SurveySelectDialog",[searchCriteria]);			return;		}				if (values.ship != 'ALL' && values.ship != '') {			searchCriteria.ship = values.ship;		}		if (values.startYear) {			searchCriteria.year = values.startYear;		}		dojo.publish("/survey_select/SurveySelectDialog",[searchCriteria]);	}});